// @require WjsLoader > WebCom
// @require JsScript > SchemeBinder
(function(m){var n=/\./g;m.register("WjsLoader","Binder",{loaderExtends:"WebCom",protoBaseClass:"Binder",__construct:function(){this.wjs.extendObject(this,{domStyle:{},cssSheetLoadQueue:[],classSaved:{},classLists:{},cssClassCounter:0,cssDomItems:{},cssRewritten:{}});this.wjs.loaders.WebCom.__construct.call(this)},parse:function(a,c,d){var b=this.type,e=this,f=arguments,h=this.protoName(a);this.cssSheetLoadQueue=[];c.css&&this.cssDomInitType(h,c,!0);this.cssSheetLoadAll(function(){d.itemParseComplete(b,
a,e.wjs.loaders.WebCom.parse.apply(e,f))});return!1},protoAddPart:function(a){var c=this.protoName(a);this.wjs.loaders.WebCom.protoAddPart.apply(this,arguments);this.cssClassInit(c,!0)},cssSheetLoadAll:function(a){var c=this,d=function(){var b=c.cssSheetLoadQueue.shift();b?c.wjs.cssSheetLoad(b,d):a&&a()};d()},cssDomInitType:function(a,c,d){var b=this.domStyle,e=this.cssDomItems;d?(e[a]=e[a]||0,e[a]++,c.css&&!b[a]&&(b[a]=this.wjs.document.createElement("style"),b[a].innerHTML=c.css.replace(/(url\(["'])(?!http[s]*:\/\/)/g,
"$1"+c.client),this.cssSheetLoadQueueAppend(b[a]),this.wjs.document.head.appendChild(b[a]))):(e[a]--,0===e[a]&&b[a]&&(b[a].parentNode.removeChild(b[a]),delete b[a]))},cssSheetLoadQueueAppend:function(a){-1===this.cssSheetLoadQueue.indexOf(a)&&this.cssSheetLoadQueue.push(a)},cssClassInit:function(a,c){for(var d=0,b,e=!1,f,h=this.wjs.classProtoLineage(a),l=[],k=h.join("-"),g=this.cssRewritten;b=h[d++];)l.push(b),"Binder"===b&&(e=!0),e&&(b=b.replace(n,"_"),f=l.join("-"),c?(this.cssClassAdd(f,k),this.cssRewriteAll(b,
this.classSaved[f]),g[f]=g[f]||0,g[f]++,-1===this.classLists[k].indexOf(this.classSaved[f])&&this.classLists[k].push(this.classSaved[f])):(g[f]--,g[f]||(this.cssRewriteAll(this.classSaved[f],b),this.cssClassRemove(f,k))))},cssClassAdd:function(a,c){var d=this.classSaved,b=this.classLists;d[a]||(d[a]="c"+this.cssClassCounter++);b[c]=b[c]||[]},cssClassRemove:function(a,c){var d=this.classLists;this.classSaved[a]&&delete this.classSaved[a];d[c]&&delete d[c]},cssRewriteAll:function(a,c){for(var d=0,b=
this.domStyle,e=Object.keys(b);d<e.length;d++)this.cssRewrite(a,c,b[e[d]])},cssRewrite:function(a,c,d){d.innerHTML=d.innerHTML.replace(RegExp("\\."+a+"(?=[\\s*|{|,|.|-|:])","g"),"."+c);this.cssSheetLoadQueueAppend(d)}})})(WjsProto);
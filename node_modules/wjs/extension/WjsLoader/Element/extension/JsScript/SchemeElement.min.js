// @require JsClass > BezierEasing
// @require JsMethod > arrayDeleteItem
(function(g){g.register("WebComScheme","SchemeElement",{classExtends:"Binder",type:"Element",variables:{parent:null,children:[],listeners:{},plugins:{},pluginsList:[],pluginMethods:{},pluginSharedMethod:null,pluginSharedQueue:null,pluginSharedMethodCallback:null,frameNextEnabled:!1,playFrameStamp:0,animations:[],domBoundingClientRect:!1},options:{fps:{defaults:24,apply:!0,dump:!0},playPlayer:{defaults:null,define:function(a,b,c){b&&(a.optionApply("parent",c),!0===b?(b=a,a.playPlayerOptions={details:[a]}):
null===b&&a.parent&&null!==a.parent.playPlayer&&(b=a.parent.playPlayer),a.stateSet("playing",b.playStarte));return b}},autoPlay:{defaults:!1,define:function(a,b){b&&a.play()},dump:!0},parentShortcut:{defaults:!1,define:function(a,b){b&&a.parent&&(a.parent[b]=a)}},plugins:{defaults:{},define:function(a,b){this.plugins={};a.pluginAddMultiple(b);return a.plugins},dump:[]},parent:{defaults:void 0,define:function(a,b){b&&b.isA("Element")&&b.elementAppend(a)},destroy:function(a){a.parent&&a.parent.elementRemove(a)}},
children:{autoInit:!1,define:function(a,b){var c=[];if("object"===typeof b)for(var d=Object.keys(b),f=0,e;e=b[d[f++]];)e=a.wjs.extendObject({},e),c.push(a.childAdd(e));return c}}},states:{playing:!1,renderEnabled:!0},__construct:function(a){this.playFrameExecuteProxy=this.playFrameExecute.bind(this);this.formulaChangeCallback=this.frameNextEnable.bind(this);this.__super("__construct",arguments);this.initElement(a);this.optionApply("children",a);this.render()},initElement:g._e,exitElement:g._e,exit:function(a){!1!==
this.exitElement()&&this.exitElementComplete(a)},exitElementComplete:function(a){var b=this,c=arguments;b.stop();b.pluginsClear();b.empty(function(){b.__super("exit",c)})},createInstance:function(a,b,c){c=c||{};c.parent=this;return this.__super("createInstance",[a,b,c])},childAdd:function(a){var b=this.wjs,c;c=a.type?a.type.split("::"):["Element",!1];delete a.type;a.parent=this;return b.loaders[c[0]].instance(c[1],a)},elementAppend:function(a){a.parent&&a.parent.elementRemove(a);this.dom&&a.dom&&
this.dom.appendChild(a.dom);this.children.push(a);a.parent=this},elementAppendTo:function(a){a.elementAppend(this)},elementRemove:function(a){this.wjs.arrayDeleteItem(this.children,a);a.parent=null},domParseInclude:function(a){a=a||{};a.parent=this;return this.__super("domParseInclude",[a])},treeMap:function(a,b){var c="string"===typeof a?this[a]:a;this.childrenMap("treeMap",arguments);c.apply(this,b)},childrenMap:function(a,b){for(var c=0,d,f="function"===typeof a;d=this.children[c++];)f?a.apply(d,
b):d[a].apply(d,b)},pluginAdd:function(a,b,c){var d=this.wjs,f=this.plugins,e=this.pluginsList;"object"===typeof a?(d=a,c=b,a=a.type):d=d.loaders.Plugin.instance(a,b);d.elementAdd(this);f[a]=f[a]||[];f[a].push(d);e.push(d);c&&c(d);return d},pluginAddMultiple:function(a,b,c){for(var d=0,f,e;e=a[d++];)c&&this.pluginGet(e.type)||(b&&this.wjs.extendObject(e,b),e.isA&&e.isA("Plugin")?(f=e,e=void 0):f=e.type,this.pluginAdd(f,e))},pluginRemoveMultiple:function(a){for(var b=0,c;c=a[b++];)c=c.type||c,this.pluginGet(c)&&
this.pluginRemove(c)},pluginGet:function(a){return this.plugins[a]?1===this.plugins[a].length?this.plugins[a][0]:this.plugins[a]:!1},pluginRemove:function(a){var b={},c=this.plugins,d;if("string"===typeof a)return this.pluginRemove(this.pluginGet(a));if(a instanceof Array){for(a=0;d=c[a++];)b[a]=this.pluginRemove(d);return b}a.elementRemove(this);this.wjs.arrayDeleteItem(c[a.type],a);this.wjs.arrayDeleteItem(this.pluginsList,a);0===Object.keys(c[a.type]).length&&delete c[a.type]},pluginsClear:function(){for(var a=
0,b;b=this.pluginsList[a++];)this.pluginRemove(b)},pluginsInvoke:function(a,b){for(var c=0,d;d=this.pluginsList[c++];)if("function"===typeof d[a])d[a](this,b)},render:function(a){!0!==this.stateGet("renderEnabled")||a&&a!==this.playPlayer&&!0!==this.playerPropagate||(this.domBoundingClientRect=this.dom?this.dom.getBoundingClientRect():!1,this.renderAnimations(),a=this.renderReset(),this.pluginsInvoke("renderDom",a),this.renderDom(a),this.renderChildren(),this.playPlayer===this&&this.dom&&this.wjs.trigger("playPlayerRender",
this.playPlayerOptions,this.dom))},renderReset:function(){return{}},renderAnimations:function(){for(var a=0,b;b=this.animations[a];)a=this.renderAnimation(a,b);this.animations.length&&this.frameNextEnable()},renderAnimation:function(a,b){for(var c=b.options.timeEnd-(new Date).getTime(),d=1-c/b.options.duration,f=0,e,g;e=b.keys[f++];)g=b.options.easing?b.options.easing.value(d):d,this[e]=b.original[e]+b.add[e]*g;return c<this.playPlayer.playFrameNext?(b.options.complete&&b.options.complete(),this.wjs.arrayDeleteByIndex(this.animations,
a),a):++a},renderDom:g._e,renderChildren:function(a){for(var b=0,c;c=this.children[b++];)this.renderChild(c,a)},renderChild:function(a,b){a.render(b)},empty:function(a){this.emptyNext(a)},emptyNext:function(a){var b=this;this.children.length?this.children[0].exit(function(){b.emptyNext(a)}):this.emptyComplete(a)},emptyComplete:function(a){a()},play:function(){this.playStarted=!0;this.treeMap("playStateStart",[this]);this.playStampStart=(new Date).getTime();this.frameNextEnable();this.playFrameExecute();
this.trigger("playStarted",[this])},stop:function(){this.treeMap("playStateQuit",[this]);this.playStarted=!1;this.trigger("playStopped",[this])},playStateStart:function(a){a===this.playPlayer&&this.stateSet("playing",!0)},playStateQuit:function(a){a===this.playPlayer&&this.stateSet("playing",!1)},playFrameNumber:function(){return!1===this.playStarted?0:Math.round((this.playFrameStamp-this.playStampStart)/1E3*this.fps)},playFrameExecute:function(){this.frameNextEnabled=!1;this.playFrameStamp=(new Date).getTime();
this.playFrameCurrent=this.playFrameNumber();this.playFrameNext=1E3/this.fps*(this.playFrameCurrent+1)+this.playStampStart-this.playFrameStamp;this.render()},playFrameNextLaunch:function(){this.frameNextEnabled&&this.wjs.window.setTimeout(this.playFrameExecuteProxy,this.playFrameNext)},animate:function(a,b){b="object"===typeof b?b:{duration:b};b=this.wjs.extendOptions(b);b.timeStart=(new Date).getTime();b.timeEnd=b.timeStart+b.duration;for(var c={keys:Object.keys(a),properties:a,original:{},add:{},
options:b},d=0,f;f=c.keys[d++];)c.original[f]=this[f],c.add[f]=a[f]-this[f];b.easing&&(b.easing=new (this.wjs.classProto("BezierEasing"))(b.easing[0],b.easing[1],b.easing[2],b.easing[3]));this.animations.push(c);this.play()},frameNextEnable:function(){!1===this.frameNextEnabled&&null!==this.playPlayer&&!0===this.playPlayer.playStarted&&(this.playPlayer!==this?this.playPlayer.frameNextEnable():(this.frameNextEnabled=!0,this.playFrameNextLaunch()))},frame:function(){this.play();this.stop()}})})(WjsProto);
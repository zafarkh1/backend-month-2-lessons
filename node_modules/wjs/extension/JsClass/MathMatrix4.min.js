// @require JsClass > MathVector3
(function(M){M.register("JsClass","MathMatrix4",{__construct:function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.lookAtX=new (this.wjs.classProto("MathVector3"));this.lookAtY=new (this.wjs.classProto("MathVector3"));this.lookAtZ=new (this.wjs.classProto("MathVector3"))},set:function(e,a,c,b,d,f,g,k,l,m,n,q,p,r,s,t){var h=this.elements;h[0]=e;h[4]=a;h[8]=c;h[12]=b;h[1]=d;h[5]=f;h[9]=g;h[13]=k;h[2]=l;h[6]=m;h[10]=n;h[14]=q;h[3]=p;h[7]=r;h[11]=s;h[15]=t;return this},copy:function(e){this.elements.set(e.elements);
return this},makeRotationFromQuaternion:function(e){var a=this.elements,c=e.x,b=e.y,d=e.z,f=e.w,g=c+c,k=b+b,l=d+d;e=c*g;var m=c*k,c=c*l,n=b*k,b=b*l,d=d*l,g=f*g,k=f*k,f=f*l;a[0]=1-(n+d);a[4]=m-f;a[8]=c+k;a[1]=m+f;a[5]=1-(e+d);a[9]=b-g;a[2]=c-k;a[6]=b+g;a[10]=1-(e+n);a[3]=0;a[7]=0;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return this},lookAt:function(e,a,c){var b=this.lookAtX,d=this.lookAtY,f=this.lookAtZ,g=this.elements;f.subVectors(e,a).normalize();0===f.length()&&(f.z=1);b.crossVectors(c,f).normalize();
0===b.length()&&(f.x+=1E-4,b.crossVectors(c,f).normalize());d.crossVectors(f,b);g[0]=b.x;g[4]=d.x;g[8]=f.x;g[1]=b.y;g[5]=d.y;g[9]=f.y;g[2]=b.z;g[6]=d.z;g[10]=f.z;return this},multiplyMatrices:function(e,a){var c=e.elements,b=a.elements,d=this.elements,f=c[0],g=c[4],k=c[8],l=c[12],m=c[1],n=c[5],q=c[9],p=c[13],r=c[2],s=c[6],t=c[10],h=c[14],u=c[3],v=c[7],w=c[11],c=c[15],x=b[0],y=b[4],z=b[8],A=b[12],B=b[1],C=b[5],D=b[9],E=b[13],F=b[2],G=b[6],H=b[10],I=b[14],J=b[3],K=b[7],L=b[11],b=b[15];d[0]=f*x+g*B+
k*F+l*J;d[4]=f*y+g*C+k*G+l*K;d[8]=f*z+g*D+k*H+l*L;d[12]=f*A+g*E+k*I+l*b;d[1]=m*x+n*B+q*F+p*J;d[5]=m*y+n*C+q*G+p*K;d[9]=m*z+n*D+q*H+p*L;d[13]=m*A+n*E+q*I+p*b;d[2]=r*x+s*B+t*F+h*J;d[6]=r*y+s*C+t*G+h*K;d[10]=r*z+s*D+t*H+h*L;d[14]=r*A+s*E+t*I+h*b;d[3]=u*x+v*B+w*F+c*J;d[7]=u*y+v*C+w*G+c*K;d[11]=u*z+v*D+w*H+c*L;d[15]=u*A+v*E+w*I+c*b;return this},multiplyScalar:function(e){var a=this.elements;a[0]*=e;a[4]*=e;a[8]*=e;a[12]*=e;a[1]*=e;a[5]*=e;a[9]*=e;a[13]*=e;a[2]*=e;a[6]*=e;a[10]*=e;a[14]*=e;a[3]*=e;a[7]*=
e;a[11]*=e;a[15]*=e;return this},setPosition:function(e){var a=this.elements;a[12]=e.x;a[13]=e.y;a[14]=e.z;return this},getInverse:function(e,a){var c=this.elements,b=e.elements,d=b[0],f=b[4],g=b[8],k=b[12],l=b[1],m=b[5],n=b[9],q=b[13],p=b[2],r=b[6],s=b[10],t=b[14],h=b[3],u=b[7],v=b[11],b=b[15];c[0]=n*t*u-q*s*u+q*r*v-m*t*v-n*r*b+m*s*b;c[4]=k*s*u-g*t*u-k*r*v+f*t*v+g*r*b-f*s*b;c[8]=g*q*u-k*n*u+k*m*v-f*q*v-g*m*b+f*n*b;c[12]=k*n*r-g*q*r-k*m*s+f*q*s+g*m*t-f*n*t;c[1]=q*s*h-n*t*h-q*p*v+l*t*v+n*p*b-l*s*b;
c[5]=g*t*h-k*s*h+k*p*v-d*t*v-g*p*b+d*s*b;c[9]=k*n*h-g*q*h-k*l*v+d*q*v+g*l*b-d*n*b;c[13]=g*q*p-k*n*p+k*l*s-d*q*s-g*l*t+d*n*t;c[2]=m*t*h-q*r*h+q*p*u-l*t*u-m*p*b+l*r*b;c[6]=k*r*h-f*t*h-k*p*u+d*t*u+f*p*b-d*r*b;c[10]=f*q*h-k*m*h+k*l*u-d*q*u-f*l*b+d*m*b;c[14]=k*m*p-f*q*p-k*l*r+d*q*r+f*l*t-d*m*t;c[3]=n*r*h-m*s*h-n*p*u+l*s*u+m*p*v-l*r*v;c[7]=f*s*h-g*r*h+g*p*u-d*s*u-f*p*v+d*r*v;c[11]=g*m*h-f*n*h-g*l*u+d*n*u+f*l*v-d*m*v;c[15]=f*n*p-g*m*p+g*l*r-d*n*r-f*l*s+d*m*s;c=d*c[0]+l*c[4]+p*c[8]+h*c[12];if(0===c){if(a)throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");
this.wjs.err("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");this.identity();return this}this.multiplyScalar(1/c);return this},scale:function(e){var a=this.elements,c=e.x,b=e.y;e=e.z;a[0]*=c;a[4]*=b;a[8]*=e;a[1]*=c;a[5]*=b;a[9]*=e;a[2]*=c;a[6]*=b;a[10]*=e;a[3]*=c;a[7]*=b;a[11]*=e;return this},compose:function(e,a,c){this.makeRotationFromQuaternion(a);this.scale(c);this.setPosition(e);return this}})})(WjsProto);